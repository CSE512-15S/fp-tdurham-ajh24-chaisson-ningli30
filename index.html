<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>3D C. elegans Development</title>

    <!-- Bootstrap core CSS -->
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/color/jquery.color.plus-names-2.1.2.min.js"></script>
    <script type="text/javascript" src="/libraries/chosen_v1.4.2/chosen.jquery.min.js"></script>
    <script src="libraries/bootstrap/js/bootstrap.min.js"></script>

    <link href="/libraries/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="http://x3dom.org/download/1.6.2/x3dom-full.js"></script>
    <script type="text/javascript" src="http://bgrins.github.io/spectrum/spectrum.js"></script>
    <script type="text/javascript" src="http://cdn.jsdelivr.net/jstat/1.2.1/jstat.min.js"></script>
    <script type="text/javascript" src="/js/development_visualization.js"></script>
    <script type="text/javascript" src="/libraries/Color_mixer-master/color_mixer.js"></script>
    <script type="text/javascript" src="/libraries/tablesorter-master/jquery.tablesorter.min.js"></script>
    <script type="text/javascript" src="/js/fisheye.js"></script>
    <!--Add IntroJs js-->
    <script type="text/javascript" src="/js/intro.js"></script>
    <!-- Add IntroJs styles -->
    <link href="/css/introjs.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="http://www.x3dom.org/download/dev/x3dom.css"/>
    <link rel="stylesheet" type="text/css" href="http://bgrins.github.io/spectrum/spectrum.css"/>
    <link rel="stylesheet" type="text/css" href="/libraries/chosen_v1.4.2/chosen.min.css"/>
    <link rel="stylesheet" type="text/css" href="/css/styles.css"/>
    <link rel="stylesheet" type="text/css" href="/libraries/tablesorter-master/themes/blue/style.css"/>

    <script type="text/javascript">
        $(document).ready(function() {
            //see http://stackoverflow.com/questions/4126206/javascript-parsefloat-1-23e-7-gives-1-23e-7-when-need-0-000000123
            // add parser to handle scientific notation through the tablesorter addParser method 
            $.tablesorter.addParser({ 
                    // set a unique id
                    id: 'scinot', 
                    is: function(s) { 
                        return /[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/.test(s); 
                    }, 
                    format: function(s) { 
                        return $.tablesorter.formatFloat(s);
                    }, 
                    type: 'numeric' 
            });
            $("#gene_report").tablesorter();
            scatterPlot3d( d3.select('#divPlot'));
        });
    </script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <div class="navbar-title">C. Elegans Development</div>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
     
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="" data-toggle="modal" data-target="#aboutModal">About</a></li>
                    <li><a href="" data-toggle="modal" data-target="#helpModal">Help</a></li>
                     <li><a class="btn btn-large btn-success" href="javascript:void(0);" onclick="javascript:introJs().start();">Show Me How</a></li>
                </ul>
            </div>
            
        </div>
    </nav>


    <div id="divPlot" class="divPlot" >
        <input type="button" id="hide-controls" value="<" class="divPlot" data-intro="Hide control panel, and enlarge view."  data-step="2">
        

        <div id="top_display_panel">

          <div id="three_d_plot" data-intro="3D-plot of C.Elegans, drag it to rotate by any direction."  data-step="6"> 

            <x3d>
              <input type="button" id="reset-button" class="divPlot" value="Reset View" data-intro="Reset 3D plot to default position."  data-step="1">

            </x3d>
            <div id="small_multiples" data-intro="3 different multiples based on 3D-plot. Also the 3D-plot rotates as one specific multiple is clicked."  data-step="7">
            </div>
          </div>
          
          <!-- Tab interface for expression plots -->
          <div id='expressionPlotTabs' role="tabpanel" data-intro="Gene expression heatmap."  data-step="8">

            <!-- Nav tabs -->
            <ul id='tabs' class="nav nav-tabs" role="tablist" data-tabs="tabs">

              <li role="presentation" class='active'><a href="#exprDiv" data-toggle="tab">Heatmap</a></li>
              <li role="presentation"><a href="#pcaDiv" data-toggle="tab">PCA</a></li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content">
              <div id='exprDiv' class="tab-pane active"></div>
              <div id="pcaDiv" class="tab-pane" ></div>
            </div>

          </div>

        </div>

    </div>
    <div id="divControls" class="divControls" >
        <div id="playback" class="control-section"  data-intro="play the growth of the lineage tree. Set the speed or drag the slider to the specific time point."  data-step="3">
          <h4>Playback</h4>
          <button id="playpause" >Play</button>
          <input type="range" id="timerange" defaultvalue="0" min="0" step="1" value="0" max="242">
          <div id="speed" class="select-style" >
            <select>
              <option>slow</option>
              <option>medium</option>
              <option>fast</option>
            </select>
          </div>
        </div>
        <div id="highlighting" class="control-section" data-intro="Customly highlight the datapoints that you are intersted, also you can use union/intersection set operations to get more details."  data-step="4">
          <h4>Highlighting</h4>

        </div>

        <div id="expression" class="control-section" data-intro="Gene Expression."  data-step="5">
          <h4>Expression</h4>
          ...Placeholder...
        </div>
    </div>

<!-- About modal dialog  -->
<div class="modal fade" id="aboutModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">About</h4>
      </div>
      <div class="modal-body">
        <h1>3D <i>C. elegans</i> Embryogenesis</h1>
        <h2>Melissa Chiasson, Timothy Durham, Andrew Hill, and Ning Li, UW Genome Sciences and Statistics</h2>
        <h4><p><i>Caenorhabditis elegans</i> (<i>C. elegans</i>) is a small roundworm used widely as a model organism in genetics and genomics. Its development has been well studied; each worm takes around 14 hours to grow from a single fertilized cell to a hatched larvae with 558 cells. This process of embryonic development progresses in a stereotyped pattern that follows an invariant cell lineage; the same branches in this tree always produce the same tissues in the hatched worm. We have a dataset that describes the spatial orientation of every cell throughout <i>C. elegans</i> embryo development time points, along with cell lineages (which cell derives from which), cell type, and cell-specific expression measurements for a set of about 250 genes. These data provide an expansive view of gene expression in the <i>C. elegans</i> embryo; however, to derive insights intogene expression patterns in different cells across time we need a tool to integrate and to allow interactive exploration of the data. Despite intense study of <i>C. elegans</i>, currently there does not exist a resource where one can interactively visualize <i>C. elegans</i> embryo development through time and interrogate how gene expression patterns change withtime, lineage, or cell type. </p>
        <p>We seek to address this lack of resource by developing an interactive visualization that includes a 3D plot of the <i>C. elegans</i> developing embryo, a lineage tree that is synched to the 3D plot, and plots of gene expression patterns. Users will be able to explore data using filters for lineage, cell type, and time point. In this way we hope to build a tool that <i>C. elegans</i> researchers can use to easily investigate patterns of gene expression during worm embryogenesis.</p></h4>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Help modal dialog  -->
<div class="modal fade" id="helpModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Help</h4>
      </div>
      <div class="modal-body">
        <p>Confused about where to start? We have two compelling examples of how this visualization can be used to better understand the development and gene expression patterns of specific lineages and cell types.</p>
        <p>For the first example, select "intestine" from the dropdown menu. Those cells that will form the intestine will then be highlighted in the color of your choice (the default is red). At the gastrulation stage of development these cells migrate dorsally from ventral locations on the outside of the embryo to locations inside the embryo, with other cells migrating ventrally to fill in the space left by their migration. When the intestinal cell type is highlighted in our 3D plot, this migration can be observed clearly from any orientation, and other interacting lineages and cell types can be identified by using the multiple lineage highlighting feature.</p>
        <p>For the second example, select "C" from the dropdown menu. By the end of our time series, cells from the C lineage migrate to the posterior-dorsal edge of the embryo, forming a complex curvature around the back of the embryo from left to right. Patterns like this are hard to understand in two-dimensions (as seen in our 2D small multiple plots), but our 3D plot provides a more natural way to gain this insight.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Gene report modal dialog -->
<div class="modal fade" id="geneModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Gene Expression Report</h4>
            </div>
            <div class="modal-body">
                <h5>Gene expression and expression specificity for all genes within the selected population:</h5>
                <table id="gene_report" cellspacing="1" class="tablesorter">
                    <thead>
                        <tr>
                            <th>Gene Name</th>
                            <th>Wormbase ID</th>
                            <th>Fraction Expressing</th>
                            <th>Fraction Expressing Selected</th>
                            <th>Gene Specificity p-val</th>
                        </tr>
                    </thead>
                    <tbody id="gene_report_body">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

  </body>
</html>
